'use strict'

Object.defineProperty(exports, '__esModule', {
  value: true,
})
exports.parseStmt = parseStmt

var _token = require('../../utils/token')

var _expression = require('../expression')

var _createError = require('../create-error')

var _keywords = require('../keywords')

var _ip = require('./ip')

var _compound = require('../compound')

var _identifier = require('../expression/identifier')

var _literal = require('../literal')

const ensureSemi = (p) => p.validateToken(p.read(), 'symbol', ';')

function parseStmt(p, token = p.read()) {
  if (!_keywords.keywords.has(token.value)) {
    return p.parseNode(token, () => {
      const body = (0, _expression.parseExpr)(p, token)
      ensureSemi(p)
      return {
        type: 'ExpressionStatement',
        body,
      }
    })
  }

  if (token.value === 'set' || token.value === 'add') {
    return p.parseNode(token, () => {
      const left = (0, _identifier.parseId)(p)
      const operator = p.validateToken(p.read(), 'operator').value
      const right = (0, _expression.parseExpr)(p)
      ensureSemi(p)
      const type = token.value === 'add' ? 'AddStatement' : 'SetStatement'
      return {
        type,
        left,
        right,
        operator,
      }
    })
  }

  if (token.value === 'unset') {
    return p.parseNode(token, () => {
      const id = (0, _identifier.parseId)(p)
      ensureSemi(p)
      return {
        type: 'UnsetStatement',
        id,
      }
    })
  }

  if (token.value === 'include') {
    return p.parseNode(token, () => {
      const moduleToken = p.read()
      const module = (0, _literal.parseLiteral)(p, moduleToken)

      if (!(module && module.type === 'StringLiteral')) {
        throw (0, _createError.createError)(
          p.source,
          'Expected one of [StringLiteral]',
          moduleToken.loc.start,
          moduleToken.loc.end
        )
      }

      ensureSemi(p)
      return {
        type: 'IncludeStatement',
        module: p.validateNode(module, 'StringLiteral'),
      }
    })
  }

  if (token.value === 'import') {
    return p.parseNode(token, () => {
      const module = (0, _identifier.parseIdentifier)(p)
      ensureSemi(p)
      return {
        type: 'ImportStatement',
        module,
      }
    })
  }

  if (token.value === 'call') {
    return p.parseNode(token, () => {
      const subroutine = (0, _identifier.parseIdentifier)(p)
      ensureSemi(p)
      return {
        type: 'CallStatement',
        subroutine,
      }
    })
  }

  if (token.value === 'declare') {
    return p.parseNode(token, () => {
      p.validateToken(p.read(), 'ident', 'local')
      const id = p.validateNode(
        (0, _identifier.parseId)(p, p.read()),
        'Identifier',
        'Member'
      )
      const valueType = p.validateToken(p.read(), 'ident').value
      ensureSemi(p)
      return {
        type: 'DeclareStatement',
        id,
        valueType,
      }
    })
  }

  if (token.value === 'return') {
    return p.parseNode(token, () => {
      let returnActionToken // `()` can be skipped

      if ((0, _token.isToken)(p.peek(), 'symbol', '(')) {
        p.take()
        returnActionToken = p.read()
        p.validateToken(p.read(), 'symbol', ')')
      } else {
        returnActionToken = p.read()
      }

      if (!_keywords.returnActions.has(returnActionToken.value)) {
        throw (0, _createError.createError)(
          p.source,
          'return action should be one of ' +
            Array.from(_keywords.returnActions.values()).join(', '),
          returnActionToken.loc.start,
          returnActionToken.loc.end
        )
      }

      const action = returnActionToken.value
      ensureSemi(p)
      return {
        type: 'ReturnStatement',
        action,
      }
    })
  }

  if (token.value === 'error') {
    return p.parseNode(token, () => {
      const status = Number(p.validateToken(p.read(), 'numeric').value) // `message` can be void

      if ((0, _token.isToken)(p.peek(), 'symbol', ';')) {
        p.take()
        return {
          type: 'ErrorStatement',
          status,
          message: undefined,
        }
      }

      const message = (0, _expression.parseExpr)(p)
      ensureSemi(p)
      return {
        type: 'ErrorStatement',
        status,
        message,
      }
    })
  }

  if (token.value === 'restart') {
    return p.parseNode(token, () => {
      ensureSemi(p)
      return {
        type: 'RestartStatement',
      }
    })
  }

  if (token.value === 'synthetic') {
    return p.parseNode(token, () => {
      const response = (0, _expression.parseExpr)(p)
      ensureSemi(p)
      return {
        type: 'SyntheticStatement',
        response,
      }
    })
  }

  if (token.value === 'log') {
    return p.parseNode(token, () => {
      const content = (0, _expression.parseExpr)(p)
      ensureSemi(p)
      return {
        type: 'LogStatement',
        content,
      }
    })
  }

  if (token.value === 'if') {
    return parseIfStatement(p, token)
  }

  if (token.value === 'sub') {
    return p.parseNode(token, () => {
      const id = (0, _identifier.parseIdentifier)(p)
      p.validateToken(p.read(), 'symbol', '{')
      const body = (0, _compound.parseCompound)(p, parseStmt, {
        until: '}',
      })
      return {
        type: 'SubroutineStatement',
        id,
        body,
      }
    })
  }

  if (token.value === 'acl') {
    return p.parseNode(token, () => {
      const id = (0, _identifier.parseIdentifier)(p)
      p.validateToken(p.read(), 'symbol', '{')
      const body = (0, _compound.parseCompound)(p, _ip.parseIp, {
        until: '}',
        semi: true,
      })
      return {
        type: 'AclStatement',
        id,
        body,
      }
    })
  }

  if (token.value === 'backend') {
    return p.parseNode(token, () => {
      const id = (0, _identifier.parseIdentifier)(p)
      p.validateToken(p.read(), 'symbol', '{')
      const body = (0, _compound.parseCompound)(p, parseBackendDef, {
        until: '}',
      })
      return {
        type: 'BackendStatement',
        id,
        body,
      }
    })
  }

  if (token.value === 'table') {
    return parseTableStatement(p, token)
  }

  if (token.value === 'director') {
    return parseDirectorStatement(p, token)
  }

  throw (0, _createError.createError)(
    p.source,
    'Statement not implemented yet',
    token.loc.start,
    token.loc.end
  )
}

function parseBackendDef(p, token = p.read()) {
  return p.parseNode(token, () => {
    p.validateToken(token, 'symbol', '.')
    const key = p.validateNode((0, _expression.parseExpr)(p), 'Identifier').name
    p.validateToken(p.read(), 'operator', '=')
    let value

    if ((0, _token.isToken)(p.peek(), 'symbol', '{')) {
      p.take()
      value = (0, _compound.parseCompound)(p, parseBackendDef, {
        until: '}',
      })
    } else {
      value = (0, _expression.parseExpr)(p)
      ensureSemi(p)
    }

    return {
      type: 'BackendDefinition',
      key,
      value,
    }
  })
}

function parseIfStatement(p, token = p.read()) {
  return p.parseNode(token, () => {
    p.validateToken(p.read(), 'symbol', '(')
    const test = (0, _expression.parseExpr)(p)
    p.validateToken(p.read(), 'symbol', ')')
    p.validateToken(p.read(), 'symbol', '{')
    const consequent = (0, _compound.parseCompound)(p, parseStmt, {
      until: '}',
    })
    let alternative = undefined
    const next = p.peek()

    if ((0, _token.isToken)(next, 'ident', /elsif|elseif/)) {
      alternative = parseIfStatement(p, p.read())
    } else if ((0, _token.isToken)(next, 'ident', 'else')) {
      p.take()

      if ((0, _token.isToken)(p.peek(), 'ident', 'if')) {
        alternative = parseIfStatement(p, p.read())
      } else {
        p.validateToken(p.read(), 'symbol', '{')
        alternative = (0, _compound.parseCompound)(p, parseStmt, {
          until: '}',
        })
      }
    }

    return {
      type: 'IfStatement',
      test,
      consequent,
      alternative,
    }
  })
}

function parseTableDef(p, token = p.read()) {
  return p.parseNode(token, () => {
    const key = p.validateToken(token, 'string').value
    p.validateToken(p.read(), 'symbol', ':')
    const value = p.validateToken(p.read(), 'string').value

    if ((0, _token.isToken)(p.peek(), 'symbol', ',')) {
      p.take()
    }

    return {
      type: 'TableDefinition',
      key,
      value,
    }
  })
}

function parseTableStatement(p, token = p.read()) {
  return p.parseNode(token, () => {
    const id = p.validateNode(
      (0, _identifier.parseId)(p, p.read()),
      'Identifier'
    )
    p.validateToken(p.read(), 'symbol', '{')
    const body = (0, _compound.parseCompound)(p, parseTableDef, {
      until: '}',
    })
    return {
      type: 'TableStatement',
      id,
      body,
    }
  })
}

function parseDirectorStatement(p, token = p.read()) {
  return p.parseNode(token, () => {
    const id = p.validateNode((0, _identifier.parseId)(p), 'Identifier')
    const directorType = p.validateNode(
      (0, _identifier.parseId)(p),
      'Identifier'
    )
    p.validateToken(p.read(), 'symbol', '{')
    const body = (0, _compound.parseCompound)(
      p,
      (p, token) => {
        if (token.value === '{') {
          const attributes = (0, _compound.parseCompound)(
            p,
            (p, token) => {
              p.validateToken(token, 'symbol', '.')
              const key = p.read().value
              p.validateToken(p.read(), 'operator', '=')
              const value = p.read().value
              ensureSemi(p)
              return {
                key,
                value,
              }
            },
            {
              until: '}',
            }
          )
          const backend = attributes.shift()
          if (
            (backend === null || backend === void 0 ? void 0 : backend.key) !==
            'backend'
          )
            // TODO: use general-purpose validate function
            throw new Error('No backend name specified')
          return {
            backend: backend.value,
            attributes,
          }
        }

        p.validateToken(token, 'symbol', '.')
        const key = p.read().value
        p.validateToken(p.read(), 'operator', '=')
        const value = p.read().value
        ensureSemi(p)
        return {
          key,
          value,
        }
      },
      {
        until: '}',
      }
    ).filter(Boolean)
    return {
      type: 'DirectorStatement',
      id,
      directorType,
      body,
    }
  })
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9wYXJzZXIvc3RhdGVtZW50L2luZGV4LnRzIl0sIm5hbWVzIjpbImVuc3VyZVNlbWkiLCJwIiwidmFsaWRhdGVUb2tlbiIsInJlYWQiLCJwYXJzZVN0bXQiLCJ0b2tlbiIsImtleXdvcmRzIiwiaGFzIiwidmFsdWUiLCJwYXJzZU5vZGUiLCJib2R5IiwidHlwZSIsImxlZnQiLCJvcGVyYXRvciIsInJpZ2h0IiwiaWQiLCJtb2R1bGVUb2tlbiIsIm1vZHVsZSIsInNvdXJjZSIsImxvYyIsInN0YXJ0IiwiZW5kIiwidmFsaWRhdGVOb2RlIiwic3Vicm91dGluZSIsInZhbHVlVHlwZSIsInJldHVybkFjdGlvblRva2VuIiwicGVlayIsInRha2UiLCJyZXR1cm5BY3Rpb25zIiwiQXJyYXkiLCJmcm9tIiwidmFsdWVzIiwiam9pbiIsImFjdGlvbiIsInN0YXR1cyIsIk51bWJlciIsIm1lc3NhZ2UiLCJ1bmRlZmluZWQiLCJyZXNwb25zZSIsImNvbnRlbnQiLCJwYXJzZUlmU3RhdGVtZW50IiwidW50aWwiLCJwYXJzZUlwIiwic2VtaSIsInBhcnNlQmFja2VuZERlZiIsInBhcnNlVGFibGVTdGF0ZW1lbnQiLCJwYXJzZURpcmVjdG9yU3RhdGVtZW50Iiwia2V5IiwibmFtZSIsInRlc3QiLCJjb25zZXF1ZW50IiwiYWx0ZXJuYXRpdmUiLCJuZXh0IiwicGFyc2VUYWJsZURlZiIsImRpcmVjdG9yVHlwZSIsImF0dHJpYnV0ZXMiLCJiYWNrZW5kIiwic2hpZnQiLCJFcnJvciIsImZpbHRlciIsIkJvb2xlYW4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFVQTs7QUFFQTs7QUFDQTs7QUFFQTs7QUFDQTs7QUFFQTs7QUFDQTs7QUFDQTs7QUFFQSxNQUFNQSxVQUFVLEdBQUlDLENBQUQsSUFBZUEsQ0FBQyxDQUFDQyxhQUFGLENBQWdCRCxDQUFDLENBQUNFLElBQUYsRUFBaEIsRUFBMEIsUUFBMUIsRUFBb0MsR0FBcEMsQ0FBbEM7O0FBRU8sU0FBU0Ms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LENBQU47QUFFRixlQUFPO0FBQ0xGLFVBQUFBLE9BQU8sRUFBRUEsT0FBTyxDQUFDaEQsS0FEWjtBQUVMK0MsVUFBQUE7QUFGSyxTQUFQO0FBSUQ7O0FBRUR0RCxNQUFBQSxDQUFDLENBQUNDLGFBQUYsQ0FBZ0JHLEtBQWhCLEVBQXVCLFFBQXZCLEVBQWlDLEdBQWpDO0FBQ0EsWUFBTTBDLEdBQUcsR0FBRzlDLENBQUMsQ0FBQ0UsSUFBRixHQUFTSyxLQUFyQjtBQUNBUCxNQUFBQSxDQUFDLENBQUNDLGFBQUYsQ0FBZ0JELENBQUMsQ0FBQ0UsSUFBRixFQUFoQixFQUEwQixVQUExQixFQUFzQyxHQUF0QztBQUNBLFlBQU1LLEtBQUssR0FBR1AsQ0FBQyxDQUFDRSxJQUFGLEdBQVNLLEtBQXZCO0FBQ0FSLE1BQUFBLFVBQVUsQ0FBQ0MsQ0FBRCxDQUFWO0FBRUEsYUFBTztBQUFFOEMsUUFBQUEsR0FBRjtBQUFPdkMsUUFBQUE7QUFBUCxPQUFQO0FBQ0QsS0FwQ1UsRUFxQ1g7QUFBRWlDLE1BQUFBLEtBQUssRUFBRTtBQUFULEtBckNXLEVBc0NYa0IsTUF0Q1csQ0FzQ0pDLE9BdENJLENBQWI7QUF3Q0EsV0FBTztBQUNMakQsTUFBQUEsSUFBSSxFQUFFLG1CQUREO0FBRUxJLE1BQUFBLEVBRks7QUFHTHVDLE1BQUFBLFlBSEs7QUFJTDVDLE1BQUFBO0FBSkssS0FBUDtBQU1ELEdBcERNLENBQVA7QUFxREQiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBCYWNrZW5kRGVmaW5pdGlvbixcbiAgRGVjbGFyZVZhbHVlVHlwZSxcbiAgRGlyZWN0b3JTdGF0ZW1lbnQsXG4gIElmU3RhdGVtZW50LFxuICBSZXR1cm5BY3Rpb25OYW1lLFxuICBTdGF0ZW1lbnQsXG4gIFRhYmxlRGVmaW5pdGlvbixcbiAgVGFibGVTdGF0ZW1lbnQsXG59IGZyb20gJy4uLy4uL25vZGVzJ1xuaW1wb3J0IHsgaXNUb2tlbiB9IGZyb20gJy4uLy4uL3V0aWxzL3Rva2VuJ1xuXG5pbXBvcnQgeyBwYXJzZUV4cHIgfSBmcm9tICcuLi9leHByZXNzaW9uJ1xuaW1wb3J0IHsgY3JlYXRlRXJyb3IgfSBmcm9tICcuLi9jcmVhdGUtZXJyb3InXG5pbXBvcnQgeyBQYXJzZXIgfSBmcm9tICcuLidcbmltcG9ydCB7IGtleXdvcmRzLCByZXR1cm5BY3Rpb25zIH0gZnJvbSAnLi4va2V5d29yZHMnXG5pbXBvcnQgeyBwYXJzZUlwIH0gZnJvbSAnLi9pcCdcbmltcG9ydCB7IFRva2VuIH0gZnJvbSAnLi4vdG9rZW5pemVyJ1xuaW1wb3J0IHsgcGFyc2VDb21wb3VuZCB9IGZyb20gJy4uL2NvbXBvdW5kJ1xuaW1wb3J0IHsgcGFyc2VJZCwgcGFyc2VJZGVudGlmaWVyIH0gZnJvbSAnLi4vZXhwcmVzc2lvbi9pZGVudGlmaWVyJ1xuaW1wb3J0IHsgcGFyc2VMaXRlcmFsIH0gZnJvbSAnLi4vbGl0ZXJhbCdcblxuY29uc3QgZW5zdXJlU2VtaSA9IChwOiBQYXJzZXIpID0+IHAudmFsaWRhdGVUb2tlbihwLnJlYWQoKSwgJ3N5bWJvbCcsICc7JylcblxuZXhwb3J0IGZ1bmN0aW9uIHBhcnNlU3RtdChwOiBQYXJzZXIsIHRva2VuOiBUb2tlbiA9IHAucmVhZCgpKTogU3RhdGVtZW50IHtcbiAgaWYgKCFrZXl3b3Jkcy5oYXModG9rZW4udmFsdWUpKSB7XG4gICAgcmV0dXJuIHAucGFyc2VOb2RlKHRva2VuLCAoKSA9PiB7XG4gICAgICBjb25zdCBib2R5ID0gcGFyc2VFeHByKHAsIHRva2VuKVxuXG4gICAgICBlbnN1cmVTZW1pKHApXG5cbiAgICAgIHJldHVybiB7IHR5cGU6ICdFeHByZXNzaW9uU3RhdGVtZW50JywgYm9keSB9XG4gICAgfSlcbiAgfVxuXG4gIGlmICh0b2tlbi52YWx1ZSA9PT0gJ3NldCcgfHwgdG9rZW4udmFsdWUgPT09ICdhZGQnKSB7XG4gICAgcmV0dXJuIHAucGFyc2VOb2RlKHRva2VuLCAoKSA9PiB7XG4gICAgICBjb25zdCBsZWZ0ID0gcGFyc2VJZChwKVxuICAgICAgY29uc3Qgb3BlcmF0b3IgPSBwLnZhbGlkYXRlVG9rZW4ocC5yZWFkKCksICdvcGVyYXRvcicpLnZhbHVlXG4gICAgICBjb25zdCByaWdodCA9IHBhcnNlRXhwcihwKVxuXG4gICAgICBlbnN1cmVTZW1pKHApXG5cbiAgICAgIGNvbnN0IHR5cGUgPSB0b2tlbi52YWx1ZSA9PT0gJ2FkZCcgPyAnQWRkU3RhdGVtZW50JyA6ICdTZXRTdGF0ZW1lbnQnXG5cbiAgICAgIHJldHVybiB7IHR5cGUsIGxlZnQsIHJpZ2h0LCBvcGVyYXRvciB9XG4gICAgfSlcbiAgfVxuXG4gIGlmICh0b2tlbi52YWx1ZSA9PT0gJ3Vuc2V0Jykge1xuICAgIHJldHVybiBwLnBhcnNlTm9kZSh0b2tlbiwgKCkgPT4ge1xuICAgICAgY29uc3QgaWQgPSBwYXJzZUlkKHApXG5cbiAgICAgIGVuc3VyZVNlbWkocClcblxuICAgICAgcmV0dXJuIHsgdHlwZTogJ1Vuc2V0U3RhdGVtZW50JywgaWQgfVxuICAgIH0pXG4gIH1cblxuICBpZiAodG9rZW4udmFsdWUgPT09ICdpbmNsdWRlJykge1xuICAgIHJldHVybiBwLnBhcnNlTm9kZSh0b2tlbiwgKCkgPT4ge1xuICAgICAgY29uc3QgbW9kdWxlVG9rZW4gPSBwLnJlYWQoKVxuICAgICAgY29uc3QgbW9kdWxlID0gcGFyc2VMaXRlcmFsKHAsIG1vZHVsZVRva2VuKVxuXG4gICAgICBpZiAoIShtb2R1bGUgJiYgbW9kdWxlLnR5cGUgPT09ICdTdHJpbmdMaXRlcmFsJykpIHtcbiAgICAgICAgdGhyb3cgY3JlYXRlRXJyb3IoXG4gICAgICAgICAgcC5zb3VyY2UsXG4gICAgICAgICAgJ0V4cGVjdGVkIG9uZSBvZiBbU3RyaW5nTGl0ZXJhbF0nLFxuICAgICAgICAgIG1vZHVsZVRva2VuLmxvYy5zdGFydCxcbiAgICAgICAgICBtb2R1bGVUb2tlbi5sb2MuZW5kXG4gICAgICAgIClcbiAgICAgIH1cblxuICAgICAgZW5zdXJlU2VtaShwKVxuXG4gICAgICByZXR1cm4ge1xuICAgICAgICB0eXBlOiAnSW5jbHVkZVN0YXRlbWVudCcsXG4gICAgICAgIG1vZHVsZTogcC52YWxpZGF0ZU5vZGUobW9kdWxlLCAnU3RyaW5nTGl0ZXJhbCcpLFxuICAgICAgfVxuICAgIH0pXG4gIH1cblxuICBpZiAodG9rZW4udmFsdWUgPT09ICdpbXBvcnQnKSB7XG4gICAgcmV0dXJuIHAucGFyc2VOb2RlKHRva2VuLCAoKSA9PiB7XG4gICAgICBjb25zdCBtb2R1bGUgPSBwYXJzZUlkZW50aWZpZXIocClcblxuICAgICAgZW5zdXJlU2VtaShwKVxuXG4gICAgICByZXR1cm4geyB0eXBlOiAnSW1wb3J0U3RhdGVtZW50JywgbW9kdWxlIH1cbiAgICB9KVxuICB9XG5cbiAgaWYgKHRva2VuLnZhbHVlID09PSAnY2FsbCcpIHtcbiAgICByZXR1cm4gcC5wYXJzZU5vZGUodG9rZW4sICgpID0+IHtcbiAgICAgIGNvbnN0IHN1YnJvdXRpbmUgPSBwYXJzZUlkZW50aWZpZXIocClcblxuICAgICAgZW5zdXJlU2VtaShwKVxuXG4gICAgICByZXR1cm4geyB0eXBlOiAnQ2FsbFN0YXRlbWVudCcsIHN1YnJvdXRpbmUgfVxuICAgIH0pXG4gIH1cblxuICBpZiAodG9rZW4udmFsdWUgPT09ICdkZWNsYXJlJykge1xuICAgIHJldHVybiBwLnBhcnNlTm9kZSh0b2tlbiwgKCkgPT4ge1xuICAgICAgcC52YWxpZGF0ZVRva2VuKHAucmVhZCgpLCAnaWRlbnQnLCAnbG9jYWwnKVxuXG4gICAgICBjb25zdCBpZCA9IHAudmFsaWRhdGVOb2RlKHBhcnNlSWQocCwgcC5yZWFkKCkpLCAnSWRlbnRpZmllcicsICdNZW1iZXInKVxuXG4gICAgICBjb25zdCB2YWx1ZVR5cGUgPSBwLnZhbGlkYXRlVG9rZW4ocC5yZWFkKCksICdpZGVudCcpXG4gICAgICAgIC52YWx1ZSBhcyBEZWNsYXJlVmFsdWVUeXBlXG5cbiAgICAgIGVuc3VyZVNlbWkocClcblxuICAgICAgcmV0dXJuIHsgdHlwZTogJ0RlY2xhcmVTdGF0ZW1lbnQnLCBpZCwgdmFsdWVUeXBlIH1cbiAgICB9KVxuICB9XG5cbiAgaWYgKHRva2VuLnZhbHVlID09PSAncmV0dXJuJykge1xuICAgIHJldHVybiBwLnBhcnNlTm9kZSh0b2tlbiwgKCkgPT4ge1xuICAgICAgbGV0IHJldHVybkFjdGlvblRva2VuOiBUb2tlblxuXG4gICAgICAvLyBgKClgIGNhbiBiZSBza2lwcGVkXG4gICAgICBpZiAoaXNUb2tlbihwLnBlZWsoKSwgJ3N5bWJvbCcsICcoJykpIHtcbiAgICAgICAgcC50YWtlKClcblxuICAgICAgICByZXR1cm5BY3Rpb25Ub2tlbiA9IHAucmVhZCgpXG5cbiAgICAgICAgcC52YWxpZGF0ZVRva2VuKHAucmVhZCgpLCAnc3ltYm9sJywgJyknKVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuQWN0aW9uVG9rZW4gPSBwLnJlYWQoKVxuICAgICAgfVxuXG4gICAgICBpZiAoIXJldHVybkFjdGlvbnMuaGFzKHJldHVybkFjdGlvblRva2VuLnZhbHVlKSkge1xuICAgICAgICB0aHJvdyBjcmVhdGVFcnJvcihcbiAgICAgICAgICBwLnNvdXJjZSxcbiAgICAgICAgICAncmV0dXJuIGFjdGlvbiBzaG91bGQgYmUgb25lIG9mICcgK1xuICAgICAgICAgICAgQXJyYXkuZnJvbShyZXR1cm5BY3Rpb25zLnZhbHVlcygpKS5qb2luKCcsICcpLFxuICAgICAgICAgIHJldHVybkFjdGlvblRva2VuLmxvYy5zdGFydCxcbiAgICAgICAgICByZXR1cm5BY3Rpb25Ub2tlbi5sb2MuZW5kXG4gICAgICAgIClcbiAgICAgIH1cblxuICAgICAgY29uc3QgYWN0aW9uID0gcmV0dXJuQWN0aW9uVG9rZW4udmFsdWUgYXMgUmV0dXJuQWN0aW9uTmFtZVxuXG4gICAgICBlbnN1cmVTZW1pKHApXG5cbiAgICAgIHJldHVybiB7IHR5cGU6ICdSZXR1cm5TdGF0ZW1lbnQnLCBhY3Rpb24gfVxuICAgIH0pXG4gIH1cblxuICBpZiAodG9rZW4udmFsdWUgPT09ICdlcnJvcicpIHtcbiAgICByZXR1cm4gcC5wYXJzZU5vZGUodG9rZW4sICgpID0+IHtcbiAgICAgIGNvbnN0IHN0YXR1cyA9IE51bWJlcihwLnZhbGlkYXRlVG9rZW4ocC5yZWFkKCksICdudW1lcmljJykudmFsdWUpXG5cbiAgICAgIC8vIGBtZXNzYWdlYCBjYW4gYmUgdm9pZFxuICAgICAgaWYgKGlzVG9rZW4ocC5wZWVrKCksICdzeW1ib2wnLCAnOycpKSB7XG4gICAgICAgIHAudGFrZSgpXG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICB0eXBlOiAnRXJyb3JTdGF0ZW1lbnQnLFxuICAgICAgICAgIHN0YXR1cyxcbiAgICAgICAgICBtZXNzYWdlOiB1bmRlZmluZWQsXG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgY29uc3QgbWVzc2FnZSA9IHBhcnNlRXhwcihwKVxuXG4gICAgICBlbnN1cmVTZW1pKHApXG5cbiAgICAgIHJldHVybiB7IHR5cGU6ICdFcnJvclN0YXRlbWVudCcsIHN0YXR1cywgbWVzc2FnZSB9XG4gICAgfSlcbiAgfVxuXG4gIGlmICh0b2tlbi52YWx1ZSA9PT0gJ3Jlc3RhcnQnKSB7XG4gICAgcmV0dXJuIHAucGFyc2VOb2RlKHRva2VuLCAoKSA9PiB7XG4gICAgICBlbnN1cmVTZW1pKHApXG5cbiAgICAgIHJldHVybiB7IHR5cGU6ICdSZXN0YXJ0U3RhdGVtZW50JyB9XG4gICAgfSlcbiAgfVxuXG4gIGlmICh0b2tlbi52YWx1ZSA9PT0gJ3N5bnRoZXRpYycpIHtcbiAgICByZXR1cm4gcC5wYXJzZU5vZGUodG9rZW4sICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gcGFyc2VFeHByKHApXG5cbiAgICAgIGVuc3VyZVNlbWkocClcblxuICAgICAgcmV0dXJuIHsgdHlwZTogJ1N5bnRoZXRpY1N0YXRlbWVudCcsIHJlc3BvbnNlIH1cbiAgICB9KVxuICB9XG5cbiAgaWYgKHRva2VuLnZhbHVlID09PSAnbG9nJykge1xuICAgIHJldHVybiBwLnBhcnNlTm9kZSh0b2tlbiwgKCkgPT4ge1xuICAgICAgY29uc3QgY29udGVudCA9IHBhcnNlRXhwcihwKVxuXG4gICAgICBlbnN1cmVTZW1pKHApXG5cbiAgICAgIHJldHVybiB7IHR5cGU6ICdMb2dTdGF0ZW1lbnQnLCBjb250ZW50IH1cbiAgICB9KVxuICB9XG5cbiAgaWYgKHRva2VuLnZhbHVlID09PSAnaWYnKSB7XG4gICAgcmV0dXJuIHBhcnNlSWZTdGF0ZW1lbnQocCwgdG9rZW4pXG4gIH1cblxuICBpZiAodG9rZW4udmFsdWUgPT09ICdzdWInKSB7XG4gICAgcmV0dXJuIHAucGFyc2VOb2RlKHRva2VuLCAoKSA9PiB7XG4gICAgICBjb25zdCBpZCA9IHBhcnNlSWRlbnRpZmllcihwKVxuICAgICAgcC52YWxpZGF0ZVRva2VuKHAucmVhZCgpLCAnc3ltYm9sJywgJ3snKVxuXG4gICAgICBjb25zdCBib2R5ID0gcGFyc2VDb21wb3VuZChwLCBwYXJzZVN0bXQsIHsgdW50aWw6ICd9JyB9KVxuXG4gICAgICByZXR1cm4geyB0eXBlOiAnU3Vicm91dGluZVN0YXRlbWVudCcsIGlkLCBib2R5IH1cbiAgICB9KVxuICB9XG5cbiAgaWYgKHRva2VuLnZhbHVlID09PSAnYWNsJykge1xuICAgIHJldHVybiBwLnBhcnNlTm9kZSh0b2tlbiwgKCkgPT4ge1xuICAgICAgY29uc3QgaWQgPSBwYXJzZUlkZW50aWZpZXIocClcblxuICAgICAgcC52YWxpZGF0ZVRva2VuKHAucmVhZCgpLCAnc3ltYm9sJywgJ3snKVxuXG4gICAgICBjb25zdCBib2R5ID0gcGFyc2VDb21wb3VuZChwLCBwYXJzZUlwLCB7IHVudGlsOiAnfScsIHNlbWk6IHRydWUgfSlcblxuICAgICAgcmV0dXJuIHsgdHlwZTogJ0FjbFN0YXRlbWVudCcsIGlkLCBib2R5IH1cbiAgICB9KVxuICB9XG5cbiAgaWYgKHRva2VuLnZhbHVlID09PSAnYmFja2VuZCcpIHtcbiAgICByZXR1cm4gcC5wYXJzZU5vZGUodG9rZW4sICgpID0+IHtcbiAgICAgIGNvbnN0IGlkID0gcGFyc2VJZGVudGlmaWVyKHApXG5cbiAgICAgIHAudmFsaWRhdGVUb2tlbihwLnJlYWQoKSwgJ3N5bWJvbCcsICd7JylcblxuICAgICAgY29uc3QgYm9keSA9IHBhcnNlQ29tcG91bmQocCwgcGFyc2VCYWNrZW5kRGVmLCB7IHVudGlsOiAnfScgfSlcblxuICAgICAgcmV0dXJuIHsgdHlwZTogJ0JhY2tlbmRTdGF0ZW1lbnQnLCBpZCwgYm9keSB9XG4gICAgfSlcbiAgfVxuXG4gIGlmICh0b2tlbi52YWx1ZSA9PT0gJ3RhYmxlJykge1xuICAgIHJldHVybiBwYXJzZVRhYmxlU3RhdGVtZW50KHAsIHRva2VuKVxuICB9XG5cbiAgaWYgKHRva2VuLnZhbHVlID09PSAnZGlyZWN0b3InKSB7XG4gICAgcmV0dXJuIHBhcnNlRGlyZWN0b3JTdGF0ZW1lbnQocCwgdG9rZW4pXG4gIH1cblxuICB0aHJvdyBjcmVhdGVFcnJvcihcbiAgICBwLnNvdXJjZSxcbiAgICAnU3RhdGVtZW50IG5vdCBpbXBsZW1lbnRlZCB5ZXQnLFxuICAgIHRva2VuLmxvYy5zdGFydCxcbiAgICB0b2tlbi5sb2MuZW5kXG4gIClcbn1cblxuZnVuY3Rpb24gcGFyc2VCYWNrZW5kRGVmKHA6IFBhcnNlciwgdG9rZW4gPSBwLnJlYWQoKSk6IEJhY2tlbmREZWZpbml0aW9uIHtcbiAgcmV0dXJuIHAucGFyc2VOb2RlKHRva2VuLCAoKSA9PiB7XG4gICAgcC52YWxpZGF0ZVRva2VuKHRva2VuLCAnc3ltYm9sJywgJy4nKVxuICAgIGNvbnN0IGtleSA9IHAudmFsaWRhdGVOb2RlKHBhcnNlRXhwcihwKSwgJ0lkZW50aWZpZXInKS5uYW1lXG4gICAgcC52YWxpZGF0ZVRva2VuKHAucmVhZCgpLCAnb3BlcmF0b3InLCAnPScpXG5cbiAgICBsZXQgdmFsdWVcblxuICAgIGlmIChpc1Rva2VuKHAucGVlaygpLCAnc3ltYm9sJywgJ3snKSkge1xuICAgICAgcC50YWtlKClcbiAgICAgIHZhbHVlID0gcGFyc2VDb21wb3VuZChwLCBwYXJzZUJhY2tlbmREZWYsIHsgdW50aWw6ICd9JyB9KVxuICAgIH0gZWxzZSB7XG4gICAgICB2YWx1ZSA9IHBhcnNlRXhwcihwKVxuICAgICAgZW5zdXJlU2VtaShwKVxuICAgIH1cblxuICAgIHJldHVybiB7IHR5cGU6ICdCYWNrZW5kRGVmaW5pdGlvbicsIGtleSwgdmFsdWUgfVxuICB9KVxufVxuXG5mdW5jdGlvbiBwYXJzZUlmU3RhdGVtZW50KHA6IFBhcnNlciwgdG9rZW46IFRva2VuID0gcC5yZWFkKCkpOiBJZlN0YXRlbWVudCB7XG4gIHJldHVybiBwLnBhcnNlTm9kZSh0b2tlbiwgKCkgPT4ge1xuICAgIHAudmFsaWRhdGVUb2tlbihwLnJlYWQoKSwgJ3N5bWJvbCcsICcoJylcblxuICAgIGNvbnN0IHRlc3QgPSBwYXJzZUV4cHIocClcblxuICAgIHAudmFsaWRhdGVUb2tlbihwLnJlYWQoKSwgJ3N5bWJvbCcsICcpJylcblxuICAgIHAudmFsaWRhdGVUb2tlbihwLnJlYWQoKSwgJ3N5bWJvbCcsICd7JylcblxuICAgIGNvbnN0IGNvbnNlcXVlbnQgPSBwYXJzZUNvbXBvdW5kKHAsIHBhcnNlU3RtdCwgeyB1bnRpbDogJ30nIH0pXG5cbiAgICBsZXQgYWx0ZXJuYXRpdmU6IElmU3RhdGVtZW50IHwgQXJyYXk8U3RhdGVtZW50PiB8IHVuZGVmaW5lZCA9IHVuZGVmaW5lZFxuXG4gICAgY29uc3QgbmV4dCA9IHAucGVlaygpXG5cbiAgICBpZiAoaXNUb2tlbihuZXh0LCAnaWRlbnQnLCAvZWxzaWZ8ZWxzZWlmLykpIHtcbiAgICAgIGFsdGVybmF0aXZlID0gcGFyc2VJZlN0YXRlbWVudChwLCBwLnJlYWQoKSlcbiAgICB9IGVsc2UgaWYgKGlzVG9rZW4obmV4dCwgJ2lkZW50JywgJ2Vsc2UnKSkge1xuICAgICAgcC50YWtlKClcblxuICAgICAgaWYgKGlzVG9rZW4ocC5wZWVrKCksICdpZGVudCcsICdpZicpKSB7XG4gICAgICAgIGFsdGVybmF0aXZlID0gcGFyc2VJZlN0YXRlbWVudChwLCBwLnJlYWQoKSlcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHAudmFsaWRhdGVUb2tlbihwLnJlYWQoKSwgJ3N5bWJvbCcsICd7JylcbiAgICAgICAgYWx0ZXJuYXRpdmUgPSBwYXJzZUNvbXBvdW5kKHAsIHBhcnNlU3RtdCwgeyB1bnRpbDogJ30nIH0pXG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgIHR5cGU6ICdJZlN0YXRlbWVudCcsXG4gICAgICB0ZXN0LFxuICAgICAgY29uc2VxdWVudCxcbiAgICAgIGFsdGVybmF0aXZlLFxuICAgIH1cbiAgfSlcbn1cblxuZnVuY3Rpb24gcGFyc2VUYWJsZURlZihwOiBQYXJzZXIsIHRva2VuOiBUb2tlbiA9IHAucmVhZCgpKTogVGFibGVEZWZpbml0aW9uIHtcbiAgcmV0dXJuIHAucGFyc2VOb2RlKHRva2VuLCAoKSA9PiB7XG4gICAgY29uc3Qga2V5ID0gcC52YWxpZGF0ZVRva2VuKHRva2VuLCAnc3RyaW5nJykudmFsdWVcblxuICAgIHAudmFsaWRhdGVUb2tlbihwLnJlYWQoKSwgJ3N5bWJvbCcsICc6JylcblxuICAgIGNvbnN0IHZhbHVlID0gcC52YWxpZGF0ZVRva2VuKHAucmVhZCgpLCAnc3RyaW5nJykudmFsdWVcblxuICAgIGlmIChpc1Rva2VuKHAucGVlaygpLCAnc3ltYm9sJywgJywnKSkge1xuICAgICAgcC50YWtlKClcbiAgICB9XG5cbiAgICByZXR1cm4geyB0eXBlOiAnVGFibGVEZWZpbml0aW9uJywga2V5LCB2YWx1ZSB9XG4gIH0pXG59XG5cbmZ1bmN0aW9uIHBhcnNlVGFibGVTdGF0ZW1lbnQoXG4gIHA6IFBhcnNlcixcbiAgdG9rZW46IFRva2VuID0gcC5yZWFkKClcbik6IFRhYmxlU3RhdGVtZW50IHtcbiAgcmV0dXJuIHAucGFyc2VOb2RlKHRva2VuLCAoKSA9PiB7XG4gICAgY29uc3QgaWQgPSBwLnZhbGlkYXRlTm9kZShwYXJzZUlkKHAsIHAucmVhZCgpKSwgJ0lkZW50aWZpZXInKVxuXG4gICAgcC52YWxpZGF0ZVRva2VuKHAucmVhZCgpLCAnc3ltYm9sJywgJ3snKVxuXG4gICAgY29uc3QgYm9keSA9IHBhcnNlQ29tcG91bmQocCwgcGFyc2VUYWJsZURlZiwgeyB1bnRpbDogJ30nIH0pXG5cbiAgICByZXR1cm4geyB0eXBlOiAnVGFibGVTdGF0ZW1lbnQnLCBpZCwgYm9keSB9XG4gIH0pXG59XG5cbmZ1bmN0aW9uIHBhcnNlRGlyZWN0b3JTdGF0ZW1lbnQoXG4gIHA6IFBhcnNlcixcbiAgdG9rZW46IFRva2VuID0gcC5yZWFkKClcbik6IERpcmVjdG9yU3RhdGVtZW50IHtcbiAgcmV0dXJuIHAucGFyc2VOb2RlKHRva2VuLCAoKSA9PiB7XG4gICAgY29uc3QgaWQgPSBwLnZhbGlkYXRlTm9kZShwYXJzZUlkKHApLCAnSWRlbnRpZmllcicpXG4gICAgY29uc3QgZGlyZWN0b3JUeXBlID0gcC52YWxpZGF0ZU5vZGUocGFyc2VJZChwKSwgJ0lkZW50aWZpZXInKVxuXG4gICAgcC52YWxpZGF0ZVRva2VuKHAucmVhZCgpLCAnc3ltYm9sJywgJ3snKVxuXG4gICAgY29uc3QgYm9keSA9IHBhcnNlQ29tcG91bmQoXG4gICAgICBwLFxuICAgICAgKHAsIHRva2VuKSA9PiB7XG4gICAgICAgIGlmICh0b2tlbi52YWx1ZSA9PT0gJ3snKSB7XG4gICAgICAgICAgY29uc3QgYXR0cmlidXRlcyA9IHBhcnNlQ29tcG91bmQoXG4gICAgICAgICAgICBwLFxuICAgICAgICAgICAgKHAsIHRva2VuKSA9PiB7XG4gICAgICAgICAgICAgIHAudmFsaWRhdGVUb2tlbih0b2tlbiwgJ3N5bWJvbCcsICcuJylcbiAgICAgICAgICAgICAgY29uc3Qga2V5ID0gcC5yZWFkKCkudmFsdWVcbiAgICAgICAgICAgICAgcC52YWxpZGF0ZVRva2VuKHAucmVhZCgpLCAnb3BlcmF0b3InLCAnPScpXG4gICAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gcC5yZWFkKCkudmFsdWVcbiAgICAgICAgICAgICAgZW5zdXJlU2VtaShwKVxuXG4gICAgICAgICAgICAgIHJldHVybiB7IGtleSwgdmFsdWUgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHsgdW50aWw6ICd9JyB9XG4gICAgICAgICAgKVxuXG4gICAgICAgICAgY29uc3QgYmFja2VuZCA9IGF0dHJpYnV0ZXMuc2hpZnQoKVxuICAgICAgICAgIGlmIChiYWNrZW5kPy5rZXkgIT09ICdiYWNrZW5kJylcbiAgICAgICAgICAgIC8vIFRPRE86IHVzZSBnZW5lcmFsLXB1cnBvc2UgdmFsaWRhdGUgZnVuY3Rpb25cbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignTm8gYmFja2VuZCBuYW1lIHNwZWNpZmllZCcpXG5cbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgYmFja2VuZDogYmFja2VuZC52YWx1ZSxcbiAgICAgICAgICAgIGF0dHJpYnV0ZXMsXG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcC52YWxpZGF0ZVRva2VuKHRva2VuLCAnc3ltYm9sJywgJy4nKVxuICAgICAgICBjb25zdCBrZXkgPSBwLnJlYWQoKS52YWx1ZVxuICAgICAgICBwLnZhbGlkYXRlVG9rZW4ocC5yZWFkKCksICdvcGVyYXRvcicsICc9JylcbiAgICAgICAgY29uc3QgdmFsdWUgPSBwLnJlYWQoKS52YWx1ZVxuICAgICAgICBlbnN1cmVTZW1pKHApXG5cbiAgICAgICAgcmV0dXJuIHsga2V5LCB2YWx1ZSB9XG4gICAgICB9LFxuICAgICAgeyB1bnRpbDogJ30nIH1cbiAgICApLmZpbHRlcihCb29sZWFuKVxuXG4gICAgcmV0dXJuIHtcbiAgICAgIHR5cGU6ICdEaXJlY3RvclN0YXRlbWVudCcsXG4gICAgICBpZCxcbiAgICAgIGRpcmVjdG9yVHlwZSxcbiAgICAgIGJvZHksXG4gICAgfVxuICB9KVxufVxuIl19
